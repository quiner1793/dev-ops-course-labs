# Kubernetes ConfigMaps

## Upgrade Application for Persistence

### Python volume for visits counter

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs$ curl 0.0.0.0:8080/visits
{"visits":0}
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs$ curl 0.0.0.0:8080/time/moscow_time
<h1>Current Moscow Time</h1><p>Current date: 2023-11-21</p><p>Current time: 19:24:36.747641</p>
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs$ curl 0.0.0.0:8080/visits
{"visits":1}
```

### Golang volume for visits counter

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs$ curl 0.0.0.0:8070/visits
{"visits":4}
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs$ curl 0.0.0.0:8070/time
<!DOCTYPE html>
<html>
    <body>
    <h1>Current Moscow Time</h1>
    <p>2023-11-21 20:20:26</p>
    </body>
</html>quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs$ curl 0.0.0.0:8070/visits
{"visits":5}
```

## Mount a Config File

### Verify configMap

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s$ kubectl get configmap python-app-configmap -o yaml
apiVersion: v1
data:
  config.json: |
    {
      "key_one": "secret_one",
      "key_two": "secret_two"
    }
  env-var: ENV_CONFIG_VAR
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: python
    meta.helm.sh/release-namespace: default
  creationTimestamp: "2023-11-21T21:50:45Z"
  labels:
    app.kubernetes.io/managed-by: Helm
  name: python-app-configmap
  namespace: default
  resourceVersion: "113937"
  uid: 93621de2-aa0f-4389-9d29-dedebbd2abf0
```

### Retrieve the list of pods

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s$ kubectl get po
NAME                                 READY   STATUS    RESTARTS   AGE
python-python-app-5844869c77-2prp9   1/1     Running   0          54s
python-python-app-5844869c77-rqhlf   1/1     Running   0          54s
python-python-app-5844869c77-x7bjq   1/1     Running   0          54s
```

### Check the ConfigMap inside the pod

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s$ kubectl exec python-python-app-5844869c77-2prp9 -- cat config_map/config.json
{
  "key_one": "secret_one",
  "key_two": "secret_two"
}
```

## Utilize ConfigMap via environment variables

### Run env command inside the container

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s$ kubectl exec python-python-app-5844869c77-2prp9 -- env | grep CONFIG_MAP_VAR
CONFIG_MAP_VAR=ENV_CONFIG_VAR
```
